#!/bin/sh

_countdown() {
    echo
    for i in 10 9 8 7 6 5 4 3 2 1; do
        printf '\r%s in %d secs   ' "$1" $i
        sleep 1
    done
    printf '\r%s now          \n' "$1"
}

# wrap sudo if not root
_sudo=''
if test "$(whoami)" != "root"; then
    _sudo=sudo
fi

case $1 in
halt)
    $_sudo pacman -Syu --noconfirm || exit $?
    _countdown "power off"
    $_sudo halt -p || exit $?
    ;;
reboot)
    $_sudo pacman -Syu --noconfirm || exit $?
    _countdown "rebooting"
    $_sudo reboot || exit $?
    ;;
*)
    echo "usage: updateand halt   - do a full system upgrade and power off"
    echo "       updateand reboot - do a full system upgrade and reboot"
    exit 1
    ;;
esac
